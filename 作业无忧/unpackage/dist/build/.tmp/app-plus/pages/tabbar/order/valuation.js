(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabbar/order/valuation"],{"00f9":function(t,e,a){"use strict";a.r(e);var n=a("40f4"),o=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,function(){return n[t]})}(i);e["default"]=o.a},"0b07":function(t,e,a){"use strict";a.r(e);var n=a("32ee"),o=a("00f9");for(var i in o)"default"!==i&&function(t){a.d(e,t,function(){return o[t]})}(i);a("d3cf");var s=a("2877"),r=Object(s["a"])(o["default"],n["a"],n["b"],!1,null,null,null);e["default"]=r.exports},"32ee":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"a",function(){return n}),a.d(e,"b",function(){return o})},"40f4":function(t,e,a){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{index:-1,imgList:[],modalName:null,textareaAValue:"",orderId:"",commentId:"",role:t.getStorageSync("userInfo").role,isCommented:0}},onLoad:function(t){this.orderId=t.orderId,this.textareaAValue=t.value,console.log(a(this.textareaAValue," at pages\\tabbar\\order\\valuation.vue:66"))},onShow:function(){},onBackPress:function(e){return 0==this.isCommented?t.showModal({title:"提示",content:"评价尚未发布，确定退出吗？",success:function(e){e.confirm&&t.switchTab({url:"/pages/tabbar/order/order"})}}):t.switchTab({url:"/pages/tabbar/order/order"}),!0},methods:{ChooseImage:function(){var e=this;t.chooseImage({count:4-this.imgList,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){0!=e.imgList.length?e.imgList=e.imgList.concat(t.tempFilePaths):e.imgList=t.tempFilePaths}})},sendCommen:function(){var e=this;console.log(a(this.textareaAValue.length," at pages\\tabbar\\order\\valuation.vue:108")),console.log(a(this.textareaAValue," at pages\\tabbar\\order\\valuation.vue:109")),this.textareaAValue.length>=200?t.showToast({title:"需要在200字符以内,目前为"+this.textareaAValue.length+"字符",icon:"none"}):(t.showLoading({title:"评论中...",mask:!0}),this.RWajax.post("/order/evaluate",{orderId:e.orderId,evaluation:e.textareaAValue}).then(function(a){1==a.data.success?(e.commentId=a.data.result,e.imgList.length>0?e.uploadImg():(t.hideLoading(),t.showToast({title:"评论发表成功",icon:"success",duration:500}),e.isCommented=1,setTimeout(function(){t.switchTab({url:"/pages/tabbar/order/order"})},1e3))):(t.hideLoading(),t.showToast({title:"发送失败",icon:"none"}))}).catch(function(e){t.hideLoading(),t.showToast({title:"发送失败",icon:"none"})}))},uploadImg:function(){var e=this,a=this.imgList;t.showLoading({title:"评论发表中..."});for(var n=0,o=function(o){t.getImageInfo({src:e.imgList[o],success:function(i){s=i.type,t.uploadFile({url:e.$host+"/file/upload",filePath:a[o],name:"file",formData:{fileName:"comment/"+e.commentId+"/"+o,fileType:s},success:function(a){var i=JSON.parse(a.data);if(1==i.success){var s=i.result;t.request({url:e.$host+"/picture/upload",method:"post",data:JSON.stringify([{linkerId:e.commentId,position:o,url:s}]),success:function(a){n++,n==e.imgList.length&&(t.hideLoading(),t.showToast({title:"评论发表成功",icon:"success",duration:500}),e.isCommented=1,setTimeout(function(){t.switchTab({url:"/pages/tabbar/order/order"})},1e3))},fail:function(t){n++}})}},fail:function(e){t.showModal({content:e.errMsg,showCancel:!1})}})}})},i=0;i<this.imgList.length;i++){var s;o(i)}},ViewImage:function(e){t.previewImage({urls:this.imgList,current:e.currentTarget.dataset.url})},DelImg:function(e){var a=this;t.showModal({title:"召唤师",content:"确定要删除这段回忆吗？",cancelText:"再看看",confirmText:"再见",success:function(t){t.confirm&&a.imgList.splice(e.currentTarget.dataset.index,1)}})},textareaAInput:function(t){this.textareaAValue=t.detail.value}}};e.default=n}).call(this,a("6e42")["default"],a("0de9")["default"])},"5e82":function(t,e,a){},bd79:function(t,e,a){"use strict";(function(t){a("85c2"),a("921b");n(a("66fd"));var e=n(a("0b07"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},d3cf:function(t,e,a){"use strict";var n=a("5e82"),o=a.n(n);o.a}},[["bd79","common/runtime","common/vendor"]]]);